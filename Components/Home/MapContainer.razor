@using WhereAreThey.Models
@using WhereAreThey.Services.Interfaces
@inject IMapStateService MapState

<RadzenStack Gap="0" Style="flex: 1; position: relative;">
    <HeatMap @ref="Map"
             ElementId="@ElementId"
             Reports="@MapState.Reports" 
             Alerts="@MapState.Alerts"
             InitialLat="@InitialLat"
             InitialLng="@InitialLng"
             IsAdmin="@IsAdmin"
             AlertCreationMode="@AlertCreationMode"
             OnMapClick="@OnMapClick"
             OnMapMoveEnd="@OnMapMoveEnd"
             OnUserInteractedWithMap="@OnUserInteractedWithMap"
             OnLocationUpdated="@OnLocationUpdated"
             OnMapContextMenu="@OnMapContextMenu"
             OnAlertDeleteClick="@OnAlertDeleteClick"
             OnAlertAreaDefined="@OnAlertAreaDefined" />
    
    @ChildContent

    <LocationOverlay OnManualPick="@OnManualPick" />
</RadzenStack>

@code {

    [Parameter] public string ElementId { get; set; } = "heatmap";
    [Parameter] public double InitialLat { get; set; }
    [Parameter] public double InitialLng { get; set; }
    [Parameter] public bool IsAdmin { get; set; }
    [Parameter] public bool AlertCreationMode { get; set; }
    [Parameter] public RenderFragment? ChildContent { get; set; }

    [Parameter] public EventCallback<HeatMap.MapClickEventArgs> OnMapClick { get; set; }
    [Parameter] public EventCallback<HeatMap.MapLocationEventArgs> OnMapMoveEnd { get; set; }
    [Parameter] public EventCallback OnUserInteractedWithMap { get; set; }
    [Parameter] public EventCallback<GeolocationPosition> OnLocationUpdated { get; set; }
    [Parameter] public EventCallback<HeatMap.MapLocationEventArgs> OnMapContextMenu { get; set; }
    [Parameter] public EventCallback<int> OnAlertDeleteClick { get; set; }
    [Parameter] public EventCallback<HeatMap.AlertAreaEventArgs> OnAlertAreaDefined { get; set; }
    [Parameter] public EventCallback OnManualPick { get; set; }

    /// <summary>
    /// Exposes the underlying HeatMap component.
    /// </summary>
    public HeatMap? Map { get; private set; }

}
