@using WhereAreThey.Models
<RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" Class="map-controls-container">
    <RadzenCard Class="rz-p-1 rz-shadow-5 search-card">
        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
            <AddressSearch @bind-SearchValue="@SearchAddressValue" 
                           OnResultSelected="@OnAddressSelectedInternal" />
            
            <RadzenToggleButton @bind-Value="@FollowMeValue" Icon="my_location" 
                                ButtonStyle="ButtonStyle.Base" Variant="Variant.Flat" 
                                Size="ButtonSize.Medium" ToolTip="Follow Me" 
                                ToggleButtonStyle="ButtonStyle.Primary"
                                Change="@OnFollowMeChange" />

            <RadzenToggleButton @bind-Value="@AlertCreationModeValue" Icon="draw" 
                                ButtonStyle="ButtonStyle.Base" Variant="Variant.Flat" 
                                Size="ButtonSize.Medium" ToolTip="Define Alert Area (Click & Drag)" 
                                ToggleButtonStyle="ButtonStyle.Warning" />
            
            <RadzenSelectBar @bind-Value="@SelectedHoursValue" TValue="int" Change="@OnHoursChange"
                             Size="ButtonSize.Small" ButtonStyle="ButtonStyle.Base" 
                             Class="time-filter">
                <Items>
                    <RadzenSelectBarItem Text="1h" Value="1" />
                    <RadzenSelectBarItem Text="2h" Value="2" />
                    <RadzenSelectBarItem Text="@($"{ReportExpiryHours}h")" Value="@ReportExpiryHours" />
                </Items>
            </RadzenSelectBar>

            @if (IsAdmin)
            {
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.25rem" Class="rz-ml-2">
                    <RadzenLabel Text="Deleted" Component="ShowDeletedSwitch" Style="font-size: 0.75rem; opacity: 0.8;" />
                    <RadzenSwitch @bind-Value="@ShowDeletedValue" Name="ShowDeletedSwitch" Size="SwitchSize.Small" />
                </RadzenStack>
            }
        </RadzenStack>
    </RadzenCard>
</RadzenStack>

@code {
    [Parameter] public string SearchAddress { get; set; } = "";
    [Parameter] public EventCallback<string> SearchAddressChanged { get; set; }
    
    private string SearchAddressValue 
    {
        get => SearchAddress;
        set => SearchAddressChanged.InvokeAsync(value);
    }

    [Parameter] public bool FollowMe { get; set; }
    [Parameter] public EventCallback<bool> FollowMeChanged { get; set; }
    private bool FollowMeValue
    {
        get => FollowMe;
        set => FollowMeChanged.InvokeAsync(value);
    }

    [Parameter] public int SelectedHours { get; set; }
    [Parameter] public EventCallback<int> SelectedHoursChanged { get; set; }
    private int SelectedHoursValue
    {
        get => SelectedHours;
        set => SelectedHoursChanged.InvokeAsync(value);
    }

    [Parameter] public int ReportExpiryHours { get; set; }
    
    [Parameter] public bool AlertCreationMode { get; set; }
    [Parameter] public EventCallback<bool> AlertCreationModeChanged { get; set; }
    private bool AlertCreationModeValue
    {
        get => AlertCreationMode;
        set => AlertCreationModeChanged.InvokeAsync(value);
    }

    [Parameter] public bool IsAdmin { get; set; }
    [Parameter] public bool ShowDeleted { get; set; }
    [Parameter] public EventCallback<bool> ShowDeletedChanged { get; set; }
    private bool ShowDeletedValue
    {
        get => ShowDeleted;
        set => ShowDeletedChanged.InvokeAsync(value);
    }
    
    [Parameter] public EventCallback<GeocodingResult> OnAddressSelected { get; set; }
    [Parameter] public EventCallback<bool> OnFollowMeChange { get; set; }
    [Parameter] public EventCallback<int> OnHoursChange { get; set; }

    private async Task OnAddressSelectedInternal(GeocodingResult result)
    {
        await OnAddressSelected.InvokeAsync(result);
    }
}
