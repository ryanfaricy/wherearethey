@using System.Globalization
@using Microsoft.Extensions.Configuration
@inject IConfiguration Configuration
<!DOCTYPE html>
<html lang="@CultureInfo.CurrentCulture.TwoLetterISOLanguageName">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Live anonymous incident reporting and heat map." />
    <base href="/" />
    <ResourcePreloader />
    <link rel="stylesheet" href="@Assets["lib/bootstrap/dist/css/bootstrap.min.css"]" />
    <link rel="stylesheet" href="@Assets["app.css"]" />
    <link rel="stylesheet" href="@Assets["WhereAreThey.styles.css"]" />
    <link id="radzen-base-theme" rel="stylesheet" href="_content/Radzen.Blazor/css/material-base.css">
    <link id="radzen-theme" rel="stylesheet" href="_content/Radzen.Blazor/css/material.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <script src="theme.js"></script>
    <script src="time-utils.js"></script>
    <script>
        // Immediate theme application to prevent flicker
        (function() {
            const stored = localStorage.getItem('app-theme');
            let actualTheme = 'light';
            if (!stored || stored === 'System' || stored === '2') {
                actualTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            } else if (stored === 'Dark' || stored === '1') {
                actualTheme = 'dark';
            }
            
            document.documentElement.setAttribute('data-theme', actualTheme);
            if (actualTheme === 'dark') {
                document.getElementById('radzen-base-theme').href = '_content/Radzen.Blazor/css/material-dark-base.css';
                document.getElementById('radzen-theme').href = '_content/Radzen.Blazor/css/material-dark.css';
            }
        })();
    </script>
    <ImportMap />
    <link rel="icon" type="image/png" href="favicon.png" />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#f44336" />
    <link rel="apple-touch-icon" href="favicon.png" />

    <!-- Social Media Meta Tags -->
    <meta property="og:title" content="AreTheyHere - Live Heat Map" />
    <meta property="og:description" content="Live anonymous incident reporting and heat map." />
    <meta property="og:image" content="@((Configuration["BaseUrl"] ?? "https://www.aretheyhere.com").TrimEnd('/'))/favicon.png" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="@(Configuration["BaseUrl"] ?? "https://www.aretheyhere.com")" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="AreTheyHere - Live Heat Map" />
    <meta name="twitter:description" content="Live anonymous incident reporting and heat map." />
    <meta name="twitter:image" content="@((Configuration["BaseUrl"] ?? "https://www.aretheyhere.com").TrimEnd('/'))/favicon.png" />

    <HeadOutlet @rendermode="InteractiveServer" />
</head>

<body>
    <div id="app-loader" class="app-loading-container">
        <div class="loading-spinner"></div>
        <div class="loading-text">AreTheyHere</div>
    </div>
    <Routes @rendermode="InteractiveServer" />
    <ReconnectModal />
    <script src="@Assets["_framework/blazor.web.js"]"></script>
    <script src="_content/Radzen.Blazor/Radzen.Blazor.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
    <script src="geolocation.js"></script>
    <script src="heatmap.js"></script>
    <script src="pwa-utils.js"></script>
    <script src="square-payments.js"></script>
    <script src="@(Configuration["Square:Environment"] == "Production" ? "https://web.squarecdn.com/v1/square.js" : "https://sandbox.web.squarecdn.com/v1/square.js")"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js');
        }

        window.hideAppLoader = function() {
            var loader = document.getElementById('app-loader');
            if (loader) {
                loader.classList.add('loaded');
                setTimeout(function() {
                    loader.style.display = 'none';
                }, 300);
            }
        };

        window.fixDialogScroll = function() {
            setTimeout(function() {
                var dialogContent = document.querySelector('.rz-dialog-content');
                if (dialogContent) {
                    dialogContent.scrollTop = 0;
                }
            }, 50);
        };
    </script>
</body>

</html>
