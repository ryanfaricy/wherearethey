@using Microsoft.Extensions.Localization
@using WhereAreThey.Models
@using WhereAreThey.Services.Interfaces
@inject DialogService DialogService
@inject ISettingsService SettingsService
@inject IStringLocalizer<App> L

<RadzenStack Gap="1.5rem" Class="rz-p-4">
    <RadzenStack Gap="0.5rem">
        <RadzenText TextStyle="TextStyle.H5" Style="font-weight: bold; color: var(--rz-primary);">@L["What_Is_This_Title"]</RadzenText>
        <RadzenText TextStyle="TextStyle.Body1">@L["What_Is_This_Desc"]</RadzenText>
    </RadzenStack>

    <hr style="border: none; border-top: 1px solid var(--rz-divider); margin: 0;" />

    <RadzenText TextStyle="TextStyle.H5" Style="font-weight: bold; color: var(--rz-primary);">@L["Quick_Help_Guide"]</RadzenText>

    <RadzenStack Gap="1rem">
        <RadzenText TextStyle="TextStyle.Subtitle1" Style="font-weight: bold;">@L["Toolbar_Actions"]</RadzenText>
        
        <HelpItem BadgeText="@L["REPORT"]" BadgeStyle="BadgeStyle.Danger" Description="@L["Report_Desc"]" />
        <HelpItem Icon="notifications" IconColor="var(--rz-warning)" Description="@L["Alerts_Desc"]" />

        @if (_settings.DonationsEnabled)
        {
            <HelpItem Icon="volunteer_activism" IconColor="var(--rz-success)" Description="@L["Donate_Desc"]" />
        }

        <RadzenStack Gap="0.5rem">
            <HelpItem Icon="settings" IconColor="var(--rz-base)" Description="@L["Settings_Desc"]" />
            
            <RadzenStack Gap="0.5rem" Class="rz-pl-8">
                <HelpItem Icon="sync" IconColor="var(--rz-success)" IconSize="1rem" Title="@L["Sync_Devices"]" Description="@L["Sync_Devices_Desc"]" />
                <HelpItem Icon="get_app" IconColor="var(--rz-success)" IconSize="1rem" Title="@L["INSTALL_APP"]" Description="@L["PWA_Install_Help"]" />
                <HelpItem Icon="ios" IconColor="var(--rz-base)" IconSize="1rem" Title="iOS" Description="@L["PWA_IOS_Install_Help"]" />
            </RadzenStack>
        </RadzenStack>

        <HelpItem Icon="refresh" IconColor="var(--rz-info)" Description="@L["Refresh_Desc"]" />
    </RadzenStack>

    <hr style="border: none; border-top: 1px solid var(--rz-divider); margin: 1rem 0;" />

    <RadzenStack Gap="1rem">
        <RadzenText TextStyle="TextStyle.Subtitle1" Style="font-weight: bold;">@L["Map_Interactions"]</RadzenText>
        
        <HelpItem Icon="report_problem" IconColor="var(--rz-danger)" Title="@L["Long_Press"]" Description="@L["Long_Press_Desc"]" />
        <HelpItem Icon="touch_app" IconColor="var(--rz-info)" Title="@L["Tap_Heat_Area"]" Description="@L["Tap_Heat_Area_Desc"]" />
        <HelpItem Icon="add_location_alt" IconColor="var(--rz-warning)" Title="@L["Tap_Empty_Area"]" Description="@L["Tap_Empty_Area_Desc"]" />
        <HelpItem Icon="notifications" IconColor="#e65100" Title="@L["Orange_Pins"]" Description="@L["Orange_Pins_Desc"]" />
    </RadzenStack>

    <hr style="border: none; border-top: 1px solid var(--rz-divider); margin: 1rem 0;" />

    <RadzenStack Gap="1rem">
        <RadzenText TextStyle="TextStyle.Subtitle1" Style="font-weight: bold;">@L["Map_Controls_Title"]</RadzenText>
        
        <HelpItem Icon="search" IconColor="var(--rz-base)" Description="@L["Search_Address_Desc"]" />
        <HelpItem Icon="my_location" IconColor="var(--rz-primary)" Description="@L["Follow_Me_Desc"]" />
        <HelpItem Icon="draw" IconColor="#e65100" Title="@L["Define_Alert_Area"]" Description="@L["Define_Alert_Area_Desc"]" />
        <HelpItem Icon="schedule" IconColor="var(--rz-info)" Description="@L["Time_Filters_Desc"]" />
    </RadzenStack>

    <hr style="border: none; border-top: 1px solid var(--rz-divider); margin: 1rem 0;" />

    <RadzenStack Gap="0.5rem">
        <RadzenText TextStyle="TextStyle.Subtitle2" Style="font-weight: bold;">@L["AntiSpam_Limits_Title"]</RadzenText>
        <RadzenText TextStyle="TextStyle.Body2">@L["AntiSpam_Limits_Desc"]</RadzenText>
        <RadzenStack Gap="0.25rem" Class="rz-pl-4">
            <RadzenText TextStyle="TextStyle.Caption">• @string.Format(L["Limit_Reports"].Value, _settings.ReportCooldownMinutes)</RadzenText>
            <RadzenText TextStyle="TextStyle.Caption">• @string.Format(L["Limit_Alerts"].Value, _settings.AlertLimitCount, _settings.ReportCooldownMinutes)</RadzenText>
            <RadzenText TextStyle="TextStyle.Caption">• @string.Format(L["Report_Expiry"].Value, _settings.ReportExpiryHours)</RadzenText>
        </RadzenStack>
    </RadzenStack>

    <RadzenText TextStyle="TextStyle.Caption" Class="opacity-75 rz-mt-2">
        @L["Privacy_Disclaimer"]
    </RadzenText>

    <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center" Class="rz-mt-2">
        <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem">
            <RadzenButton Text="@L["PRIVACY"]" Click="@ShowPrivacyPolicy" ButtonStyle="ButtonStyle.Info" Size="ButtonSize.Small" Variant="Variant.Text" />
            <RadzenButton Text="@L["FEEDBACK"]" Click="@ShowFeedback" ButtonStyle="ButtonStyle.Info" Size="ButtonSize.Small" Variant="Variant.Text" />
        </RadzenStack>
        <RadzenButton Text="@L["GOT_IT"]" Click="@(() => DialogService.Close())" ButtonStyle="ButtonStyle.Primary" />
    </RadzenStack>
</RadzenStack>

@code {
    private SystemSettings _settings = new();

    protected override async Task OnInitializedAsync()
    {
        _settings = await SettingsService.GetSettingsAsync();
    }

    private async Task ShowPrivacyPolicy()
    {
        await DialogService.OpenAsync<PrivacyPolicyDialog>(L["PRIVACY_POLICY"], null, 
            DialogConfigs.Default);
    }

    private async Task ShowFeedback()
    {
        await DialogService.OpenAsync<FeedbackDialog>(L["FEEDBACK"], null, 
            DialogConfigs.Default);
    }
}
